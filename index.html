<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3737/3737372.png">
    <title>Einkauf Pro</title>
    <style>
        :root { --apple-blue: #007AFF; --apple-gray: #8e8e93; }
        body { font-family: -apple-system, system-ui; background: #f2f2f7; margin: 0; padding-bottom: env(safe-area-inset-bottom); scroll-behavior: smooth; }
        
        .header { 
            position: sticky; top: 0; background: rgba(255,255,255,0.9); 
            backdrop-filter: blur(15px); padding: 50px 20px 15px; 
            border-bottom: 1px solid #d1d1d6; z-index: 100;
        }

        .input-area { display: flex; gap: 10px; margin-bottom: 15px; }
        
        .input-field {
            flex: 1; padding: 12px; border-radius: 10px;
            border: none; background: #e3e3e8; font-size: 16px; outline: none;
        }

        .add-btn {
            background: var(--apple-blue); color: white; border: none;
            border-radius: 10px; padding: 0 15px; font-weight: bold; font-size: 20px;
        }

        /* Suchfeld Container für das X */
        .search-container { position: relative; width: 100%; }

        .search-box {
            width: 100%; padding: 8px 35px 8px 12px; border-radius: 8px; box-sizing: border-box;
            border: none; background: #eeeef0; font-size: 14px; outline: none;
        }

        .clear-search {
            position: absolute; right: 8px; top: 50%; transform: translateY(-50%);
            width: 18px; height: 18px; background: var(--apple-gray); color: white;
            border-radius: 50%; display: none; align-items: center; justify-content: center;
            font-size: 12px; font-weight: bold; cursor: pointer; opacity: 0.8;
        }

        .list-container { padding: 15px; padding-bottom: 80px; }

        .list-item {
            background: white; padding: 14px; border-radius: 12px;
            margin-bottom: 8px; display: flex; align-items: center;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }

        .list-item input[type="checkbox"] {
            width: 24px; height: 24px; margin-right: 15px; accent-color: var(--apple-blue);
        }

        .item-text { font-size: 17px; flex-grow: 1; cursor: pointer; }
        .checked { background: #f0f9ff; border: 1px solid #b3d7ff; }
        .checked .item-text { font-weight: 600; color: #000; }

        .delete-btn { color: #ff3b30; font-size: 18px; padding: 5px 10px; opacity: 0.3; }
        
        .section-divider {
            display: flex; justify-content: space-between; align-items: center;
            font-size: 12px; font-weight: bold; color: #8e8e93;
            margin: 20px 0 10px 5px; text-transform: uppercase;
        }

        .reset-link { color: var(--apple-blue); cursor: pointer; text-transform: none; font-weight: normal; }

        .edit-hint { font-size: 10px; color: #8e8e93; text-align: center; margin-top: -10px; margin-bottom: 10px; }

        #scrollTopBtn {
            position: fixed; bottom: 30px; right: 20px;
            background: var(--apple-blue); color: white;
            width: 45px; height: 45px; border-radius: 50%;
            display: none; align-items: center; justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            border: none; font-size: 24px; z-index: 1000;
        }
    </style>
</head>
<body>

<div class="header">
    <div class="input-area">
        <input type="text" id="newItemInput" class="input-field" placeholder="Neuer Artikel...">
        <button class="add-btn" onclick="addNewItem()">+</button>
    </div>
    <div class="edit-hint">Tippe auf Text zum Umbenennen • Haken = Oben fixieren</div>
    
    <div class="search-container">
        <input type="text" class="search-box" id="searchInput" placeholder="In Liste suchen..." oninput="handleSearchInput()">
        <div id="clearSearchBtn" class="clear-search" onclick="clearSearch()">✕</div>
    </div>
</div>

<div id="listContainer" class="list-container"></div>

<button id="scrollTopBtn" onclick="window.scrollTo(0,0)">↑</button>

<script>
    const initialList = [
        "5-Minuten Terrine", "Alpecin", "Alufolie", "Äpfel", "Aufschnitt", "Avocado", "Ayran", "Backpapier", 
        "Bacon", "Bananen", "Bier", "Bio-Edamer", "Bistro-Baguettes", "Blauschimmelkäse", "Bratfett", 
        "Bratkartoffeln", "Bressot", "Brie-Käse", "Brot Sü", "Chips", "Cola (0,3l)", "Curly fries", 
        "Dosensuppen", "Duschgel", "Eier", "Eis", "Eis-Bonbons", "Entfärbetücher", "Entkalker - Geschirrspülmaschine", 
        "Fassbrause", "Fertigsalat", "Fischdose", "Fischstäbchen", "Fleischsalat", "Fritz", "Gel", "Gelbe Säcke", 
        "Geschirrspülerdeo", "Geschirrspültabs", "Gordon Bleu", "Gurke", "Haferflocken", "Hanuta", "Hildegard", 
        "Honig", "Hygienespüler", "Interdentalbürsten", "Joghurt", "Kaergarden - gesalzen", "Kaergarden - ungesalzen", 
        "Kaffee", "Kalktabs - Geschirrspülmaschine", "Kalktabs - Waschmaschine", "Kartoffeln", "Ketchup", 
        "Knäckebrot", "Kotti", "Küchenrolle", "Kühlschrankdeo", "Labello", "Lasagne", "Lätta", "Leberwurst (Glas)", 
        "Leergut", "Listerine", "Mais", "Marmelade", "Meerettich", "Mett", "Milch (3,5%)", "Müller-Milch", 
        "Mülltüten - Bio", "Mülltüten 35l", "Müsli", "Naschi", "Nutella", "Ouzo", "Paprika", "Peperoni", 
        "Pernod", "Pfeffer", "Pizza", "Pommes", "Preiselbeeren", "Putzmittel", "Radler", "Remoulade", "Saft", 
        "Sagrotan Seife", "Salat geschnitten", "Salate (Brotaufstrich)", "Salz", "Saure Gurken", "Schlagsahne", 
        "Senf", "Shampoo", "Smacks", "Spinat", "Spüli", "Sylter", "Tee", "Toast - dunkel", "Toast - hell", 
        "Toipa", "Tomaten", "Vogelfutter", "Waschmittel", "Wasser Li", "Wasser Mi", "Wasser Sü", "Würfelzucker", 
        "Zahnbürstenaufsatz", "Zahnpasta", "Zitronen"
    ];

    let items = JSON.parse(localStorage.getItem('myShoppingList'));
    if (!items) {
        items = initialList.map(name => ({ name, checked: false }));
    }

    window.onscroll = function() {
        const btn = document.getElementById("scrollTopBtn");
        if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
            btn.style.display = "flex";
        } else {
            btn.style.display = "none";
        }
    };

    function handleSearchInput() {
        const input = document.getElementById('searchInput');
        const clearBtn = document.getElementById('clearSearchBtn');
        clearBtn.style.display = input.value.length > 0 ? "flex" : "none";
        render();
    }

    function clearSearch() {
        const input = document.getElementById('searchInput');
        input.value = '';
        handleSearchInput();
        input.focus();
    }

    function sortItems() {
        items.sort((a, b) => {
            if (a.checked !== b.checked) return a.checked ? -1 : 1;
            return a.name.localeCompare(b.name, 'de', { sensitivity: 'base' });
        });
    }

    function resetAll() {
        if(confirm('Alle Markierungen aufheben?')) {
            items.forEach(item => item.checked = false);
            render();
            window.scrollTo(0,0);
        }
    }

    function render() {
        const container = document.getElementById('listContainer');
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        container.innerHTML = '';
        
        sortItems();

        let separatorAdded = false;
        const hasChecked = items.some(i => i.checked);

        items.forEach((item, index) => {
            if (item.name.toLowerCase().includes(searchTerm)) {
                
                if (!item.checked && hasChecked && !separatorAdded && searchTerm === "") {
                    const divider = document.createElement('div');
                    divider.className = 'section-divider';
                    divider.innerHTML = `<span>Alle Artikel</span><span class="reset-link" onclick="resetAll()">Alle abwählen</span>`;
                    container.appendChild(divider);
                    separatorAdded = true;
                }

                const div = document.createElement('div');
                div.className = `list-item ${item.checked ? 'checked' : ''}`;
                div.innerHTML = `
                    <input type="checkbox" ${item.checked ? 'checked' : ''} onchange="toggleItem(${index})">
                    <span class="item-text" onclick="renameItem(${index})">${item.name}</span>
                    <span class="delete-btn" onclick="removeItem(${index})">✕</span>
                `;
                container.appendChild(div);
            }
        });
        localStorage.setItem('myShoppingList', JSON.stringify(items));
    }

    function addNewItem() {
        const input = document.getElementById('newItemInput');
        if (input.value.trim() !== '') {
            items.push({ name: input.value.trim(), checked: true });
            input.value = '';
            render();
            window.scrollTo(0,0);
        }
    }

    function toggleItem(index) {
        items[index].checked = !items[index].checked;
        render();
    }

    function removeItem(index) {
        if(confirm('Artikel löschen?')) {
            items.splice(index, 1);
            render();
        }
    }

    function renameItem(index) {
        const currentName = items[index].name;
        const newName = prompt("Artikel umbenennen:", currentName);
        if (newName !== null && newName.trim() !== "") {
            items[index].name = newName.trim();
            render();
        }
    }

    render();
</script>

</body>
</html>
